<!-- … head igual … -->
<body>
  <h1>Registrar depósito / transferencia</h1>

  <div class="alert" id="authBanner">
    <span id="authText">Revisando estado de OneDrive…</span>
    <button type="button" id="btnStatus">Revisar estado</button>
    <!-- ABRE EN OTRA PESTAÑA PARA NO BLOQUEAR -->
    <a href="/auth/start" target="_blank" style="margin-left:8px">Conectar ahora</a>
  </div>

  <!-- resto del formulario sin cambios … -->

  <script>
    // … todo tu JS igual …
    // Estado OneDrive (poll manual con botón)
    async function refreshStatus() {
      try {
        const r = await fetch('/auth/status');
        const d = await r.json();
        if (d.ok) {
          authText.textContent = "OneDrive conectado ✔";
        } else {
          authText.textContent = "OneDrive no conectado.";
          console.log(d);
        }
      } catch(e) {
        authText.textContent = "No se pudo verificar OneDrive.";
      }
    }
    btnStatus.addEventListener('click', refreshStatus);
    refreshStatus();
  </script>
</body>
</html>
